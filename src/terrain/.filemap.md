# Terrain Module (`frontend/src/terrain`)

Block system, materials, and terrain rendering using Three.js InstancedMesh.

## Files

| File | Purpose |
|------|---------|
| `index.ts` | Main Terrain class: BlockType enum, InstancedMesh management, ground plane, raycasting |

## Subdirectories

| Directory | Purpose |
|-----------|---------|
| `mesh/` | Block class and material definitions |
| `highlight/` | Block highlight on crosshair |
| `noise/` | Perlin noise for procedural terrain (disabled in MVP) |
| `worker/` | Web Worker for terrain generation (disabled in MVP) |

## BlockType Enum (`index.ts`)

```typescript
enum BlockType {
  // Texture blocks (indices 0-11) - disabled in MVP
  grass = 0, sand = 1, tree = 2, leaf = 3, dirt = 4, stone = 5,
  coal = 6, wood = 7, diamond = 8, quartz = 9, glass = 10, bedrock = 11,
  // Color blocks (indices 12-21) - used in MVP
  red = 12, orange = 13, yellow = 14, green = 15, blue = 16,
  violet = 17, brown = 18, white = 19, gray = 20, black = 21
}
```

## Terrain Class Key Properties

| Property | Type | Purpose |
|----------|------|---------|
| `blocks[]` | InstancedMesh[] | One mesh per BlockType for efficient rendering |
| `customBlocks[]` | Block[] | All blocks (placed and removed) for save/load |
| `blocksMap` | Map<string, Block> | O(1) lookup by position key `${x}_${y}_${z}` |
| `userPlacedBlockCount` | number | Cached count (excludes ground), O(1) access |

## Ground Plane

- 100x100 gray blocks at Y=-0.5 (top surface at Y=0)
- Yellow marker blocks at grid intersections (every 10 units)
- Centered at origin: X: -50 to 49, Z: -50 to 49
- Protected from removal (isGround flag)

## Mesh Subdirectory (`mesh/`)

| File | Purpose |
|------|---------|
| `block.ts` | Block class: position, type, color, isGround, tags, tagConfig |
| `materials.ts` | MaterialType enum, MeshStandardMaterial instances for each type |

## Block Class Properties

```typescript
class Block {
  x, y, z: number      // Three.js coordinates
  type: BlockType      // Enum value
  placed: boolean      // true = visible, false = removed
  color: string        // Hex color "#RRGGBB"
  isGround: boolean    // true = ground plane block (protected)
  tags?: string[]      // Future: game mechanic tags
  tagConfig?: Record<string, any>  // Future: tag configurations
}
```

## Highlight Subdirectory (`highlight/`)

| File | Purpose |
|------|---------|
| `index.ts` | BlockHighlight class: raycasts from camera, renders translucent highlight mesh |

## Legacy/Disabled Subdirectories

| Directory | Status | Purpose |
|-----------|--------|---------|
| `noise/` | Disabled | Perlin noise for procedural terrain generation |
| `worker/` | Disabled | Web Worker for chunk-based terrain generation |

## Related Files

- Control (placement): `control/index.ts`
- Export serialization: `export/serialize.ts`
- Color constants: `constants.ts`
