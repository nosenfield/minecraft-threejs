# Frontend Source (`frontend/src`)

Three.js-based voxel level editor for the Roblox Level Builder MVP.

## Architecture Overview

The frontend provides a browser-based 3D block editor using Three.js. Users place/remove colored blocks on a ground plane, then export to `.rbxlx` format via the backend API.

## Core Modules

| File | Purpose |
|------|---------|
| `main.ts` | App entry point. Initializes Core, Player, Terrain, Control, UI, Audio modules and starts render loop |
| `constants.ts` | Shared constants: coordinate bounds (Three.js and Roblox scaled), color hex values, block limits (10,000 max) |
| `vite-env.d.ts` | Vite TypeScript declarations (auto-generated) |

## Directory Structure

| Directory | Purpose | Key Files |
|-----------|---------|-----------|
| `audio/` | Sound effects (currently disabled) | `index.ts` |
| `control/` | Input handling, block placement/removal, flying camera | `index.ts`, `worker/` |
| `core/` | Three.js scene, camera, renderer setup | `index.ts` |
| `export/` | Space JSON serialization for backend | `index.ts`, `serialize.ts` |
| `player/` | Player state, movement modes, speeds | `index.ts` |
| `terrain/` | Block system, materials, ground plane, highlighting | `index.ts`, `mesh/`, `highlight/`, `noise/`, `worker/` |
| `ui/` | UI components: FPS counter, block counter, bag, menus | `index.ts`, `bag/`, `fps/`, `joystick/` |
| `utils/` | Utility functions: DOM helpers, mobile detection, color conversion | `index.ts` |

## Data Flow

1. **User Interaction** - `control/index.ts` handles keyboard/mouse input
2. **Block Management** - `terrain/index.ts` manages block instances via Three.js InstancedMesh
3. **Visual Rendering** - `core/index.ts` provides scene/camera, `terrain/mesh/` provides materials
4. **Export** - `export/serialize.ts` converts blocks to Space JSON with coordinate scaling (3x2 = Roblox studs)
5. **Backend API** - `ui/index.ts` POSTs Space JSON to `/api/export`, receives `.rbxlx` file

## Key Concepts

- **Block Types** - Enum in `terrain/index.ts` (12 texture types + 10 color types)
- **Materials** - `terrain/mesh/materials.ts` defines MeshStandardMaterial for each BlockType
- **Ground Plane** - 100x100 gray blocks at Y=-0.5 with yellow markers every 10 units
- **Coordinate Scaling** - Three.js units * 2 = Roblox studs (handled in `export/serialize.ts`)
- **Block Limit** - MAX_USER_BLOCKS = 10,000 (ground blocks excluded from count)

## Controls

- **WASD** - Move in camera direction
- **Q/E** - Move down/up (absolute Y axis)
- **Space** - Toggle speed (walking/sprint)
- **1-9, 0** - Select color block (red, orange, yellow, green, blue, violet, brown, white, gray, black)
- **Left Click** - Place block
- **Right Click** - Remove block (ground blocks protected)
- **Scroll Wheel** - Cycle through colors
- **F** - Toggle fullscreen
- **Esc** - Open menu

## Related Documentation

- Backend schema: `backend/src/models.rs`
- Architecture: `_docs/architecture.md`
- PRD: `_docs/prd.md`
